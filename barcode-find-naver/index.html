<html>
<head>
	<title>바코드로 네이버쇼핑 쫒기</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
</head>
<body>
	<script >
	
	const barcode = document.location.hash.replaceAll('#','');
	const queryString = window.location.search.slice(1);
	let hrefQuery = {}
	if(queryString){
		hrefQuery = JSON.parse('{"' + decodeURI(queryString.replace(/&/g, "\",\"").replace(/=/g,"\":\"")) + '"}');
	}
	
	fetch(`https://gs1.koreannet.or.kr/pr/${barcode}`, {
	  "method": "GET",
	  "mode": "cors",
	  "withCredentials": false
	}).then(d=>{
		d.text().then(d1=>{
		   const text = d1.replace(/[\r\n\t]/g,"").replace(/^.*<h3>(.+)<\/h3>.*$/,'$1');
		   let query = encodeURIComponent(text);
		   if(text.length > 1000){
				query = barcode;
		   }
		   if(hrefQuery.site === 'danawa'){
				location.href =	`https://search.danawa.com/mobile/dsearch.php?keyword=${query}&sort=priceASC`
		   }else if(hrefQuery.site === 'coupang'){
				location.href = `https://m.coupang.com/nm/search?q=${query}`;
		   }else {
				location.href = `https://msearch.shopping.naver.com/search/all?query=${query}&sort=price_asc`;
		   };
		})
	})
	</script>
</body>
</html>
